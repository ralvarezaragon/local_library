# Set the base image to Ubuntu
FROM ubuntu:16.04
# File Author / Maintainer
MAINTAINER Rafa Alvarez

ENV DEBIAN_FRONTEND noninteractive

RUN apt-get update && apt-get upgrade -y
RUN apt-get install --assume-yes apt-utils
RUN apt-get install -y python-software-properties vim wget curl netcat software-properties-common debconf-utils htop

RUN apt-key adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 0xF1656F24C74CD1D8
RUN add-apt-repository 'deb [arch=amd64,i386,ppc64el] http://tedeco.fi.upm.es/mirror/mariadb/repo/10.2/ubuntu xenial main'
RUN echo "mariadb-server-10.1 mariadb-server/root_password password iamroot" | debconf-set-selections
RUN echo "mariadb-server-10.1 mariadb-server/root_password_again password iamroot" | debconf-set-selections
RUN apt-get update
RUN apt-get install -y mariadb-server

RUN update-rc.d mysql disable



RUN echo "\033[0;31m *** ROOT PASSWORD SI SET TO iamroot BY DEFAULT. PLEASE CHANGE IT ASAP *** \033[0m"

CMD bash

# create entry point and script this:
if mysql folder doesn't exists:
  rm -r /var/lib/mysql/*
  mysql_install_db --user=mysql
chown -R mysql:mysql /var/lib/mysql
chown -R mysql:mysql /var/log/mysql
chown mysql:mysql /etc/mysql/my.cnf
GRANT SELECT, RELOAD on *.* TO 'debian-sys-maint'@'localhost' IDENTIFIED BY 'viDrrUBGw4Iu9hcY'; 
GRANT RELOAD, LOCK TABLES, REPLICATION CLIENT ON *.* TO 'sstuser'@'localhost' IDENTIFIED BY 's3cr3t';
         